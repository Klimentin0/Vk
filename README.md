# Профильное задание от VK

---
- [Установка и запуск](#установка-и-запуск)
- [Краткое описание](#краткое-описание)

## Установка и запуск

### Предварительные установки
На системе должны быть установлены 
> **git** 

> **docker engine** 

> **docker compose plugin**

Далее создаём рабочую директорию программы при помощи:
```
git clone https://github.com/Klimentin0/Vk
```
Как директория будет создана далее переходим в корневую директорию:
```
cd Vk
```
И запускаем проект
```
docker compose up

```
Отображение в браузере происходит на:
> http://localhost:3000/
## Краткое описание
### Pinger
Пингер использует докеровский пакет (github.com/docker/docker/client), чтобы получить список активных контейнеров в сети vk_default(докер копоус создаёт её по дефолту в режиме моста).
Далее мы их раскидываем в слайс страктов из которого перебираем для последую щего пинга. Сам пинг происходит докервской командой
```
exec.Command("docker", "exec", thisID, "ping", "-c", "1", containerID)
```
для единичного пинга. Таким же образом получаем имя и IP контейнера.
После чего маршалим результат и отправляем POST запросом на наш API.
Функция pingAllContainer() пингует каждый из доступных контецнров и отправляет рещультат на API.
Пинги происходят кажде 7 секунд. так что это практически лайв-сервис.
### API
Тут мы инициилизируем БД(даём ей время это сделать при первом создании), создаём таблицу в ней. Далее три хэндлера для обработки запросов к нашему API(для инсёрта в БД новых результатов пинга и 2 хэндлера для фронтенда для получения JSON-ов с информацией о пингах.). Также небольшая функция для обхода CORS блокировки(в целях упрощения разработки).
### REACT
Простой фронт на реакте
> http://localhost:3000

Получает JSON-ы от хэндлера на нашем API, обновляется каждые 5(последние 5 откликов) и каждые 10 секунд таблица со всеми олткликами (live-сервис). 
### Postgres

При билде контейнера с постгрес в docker compose указал текущую папку для вольюма, чтобы прям тут хранилась DB
- postgres_data/ отправляется в .gitignore

```
volumes:
      - ./postgres_data:/var/lib/postgresql/data
```